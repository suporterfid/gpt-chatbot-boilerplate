/* GPT Chatbot Widget Styles */

/*
 * Design token map (can be overridden via CSS variables or initialization options):
 * --chatbot-primary-color: accent color for interactive elements.
 * --chatbot-accent-color: hover/active accent variant.
 * --chatbot-background-color: message pane background.
 * --chatbot-surface-color: card/background surface color.
 * --chatbot-text-color / --chatbot-muted-color: primary and secondary text colors.
 * --chatbot-border-color: divider/border color.
 * --chatbot-user-bubble / --chatbot-assistant-bubble: bubble fills per role.
 * --chatbot-font-family / --chatbot-font-size: typography base.
 * --chatbot-border-radius: global corner radius.
 * --chatbot-shadow: elevation for floating surfaces.
 * --chatbot-width / --chatbot-height / --chatbot-min-height / --chatbot-max-height: sizing tokens.
 * --chatbot-spacing: global spacing rhythm.
 * --chatbot-transition: transition timing for interactions.
 */

/* Reset and base styles aligned with brand visual identity */
.chatbot-widget {
    --chatbot-primary-color: #5f6360;
    --chatbot-accent-color: rgb(var(--color_49, 80, 120, 255));
    --chatbot-background-color: rgb(var(--color_50, 249, 249, 250));
    --chatbot-surface-color: #FFFFFF;
    --chatbot-text-color: rgb(var(--color_51, 38, 38, 38));
    --chatbot-muted-color: rgba(38, 38, 38, 0.65);
    --chatbot-border-color: rgb(var(--color_52, 208, 208, 210));
    --chatbot-user-bubble: var(--chatbot-primary-color);
    --chatbot-assistant-bubble: var(--chatbot-surface-color);
    --chatbot-font-family: "Arial", "Helvetica", "helvetica-w01-bold", -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    --chatbot-font-size: 14px;
    --chatbot-border-radius: 16px;
    --chatbot-shadow: 0 16px 32px -12px rgba(0, 0, 0, 0.25);
    --chatbot-width: min(360px, 100%);
    --chatbot-height: 520px;
    --chatbot-min-height: 320px;
    --chatbot-max-height: 85vh;
    --chatbot-spacing: 16px;
    --chatbot-transition: 0.25s ease;

    font-family: var(--chatbot-font-family);
    font-size: var(--chatbot-font-size);
    line-height: 1.5;
    color: var(--chatbot-text-color);
    box-sizing: border-box;
}

.chatbot-widget *,
.chatbot-widget *::before,
.chatbot-widget *::after {
    box-sizing: border-box;
}

.chatbot-widget button,
.chatbot-widget .chatbot-toggle,
.chatbot-widget .proactive-cta,
.chatbot-widget .proactive-dismiss {
    outline: none;
}

.chatbot-widget button:focus-visible,
.chatbot-widget .chatbot-toggle:focus-visible,
.chatbot-widget .proactive-cta:focus-visible,
.chatbot-widget .proactive-dismiss:focus-visible {
    outline: 2px solid var(--chatbot-primary-color);
    outline-offset: 2px;
}

/* Floating widget styles */
.chatbot-floating {
    position: fixed;
    z-index: 10000;
}

.chatbot-floating.position-bottom-right {
    bottom: 20px;
    right: 20px;
    left: auto;
    top: auto;
}

.chatbot-floating.position-bottom-left {
    bottom: 20px;
    left: 20px;
    right: auto;
    top: auto;
}

.chatbot-floating.position-top-right {
    top: 20px;
    right: 20px;
    bottom: auto;
    left: auto;
}

.chatbot-floating.position-top-left {
    top: 20px;
    left: 20px;
    bottom: auto;
    right: auto;
}

/* Toggle button (floating mode) */
.chatbot-toggle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: var(--chatbot-primary-color);
    color: white;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--chatbot-shadow);
    transition: all 0.3s ease;
}

.chatbot-toggle:hover {
    transform: scale(1.05);
    background: var(--chatbot-accent-color);
}

/* Widget container */

.chatbot-container {
    width: var(--chatbot-width, 350px);
    height: var(--chatbot-height, 500px);
    min-height: var(--chatbot-min-height, 320px);
    max-height: var(--chatbot-max-height, 85vh);
    background: var(--chatbot-surface-color);
    border-radius: var(--chatbot-border-radius);
    box-shadow: var(--chatbot-shadow);
    border: 1px solid var(--chatbot-border-color);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
    min-height: 0;
    transition: transform var(--chatbot-transition), box-shadow var(--chatbot-transition);
}

.chatbot-inline .chatbot-container {
    width: 100%;
    height: 100%;
}

.chatbot-widget.layout-compact {
    --chatbot-spacing: 12px;
    --chatbot-font-size: 13px;
    --chatbot-border-radius: 12px;
}

.chatbot-widget.layout-compact .chatbot-message {
    margin-bottom: 12px;
}

.chatbot-widget.layout-spacious {
    --chatbot-spacing: 20px;
    --chatbot-font-size: 15px;
    --chatbot-border-radius: 20px;
}

.chatbot-widget.layout-spacious .chatbot-message {
    margin-bottom: 20px;
}

/* Header */
.chatbot-header {
    background: var(--chatbot-primary-color);
    color: white;
    padding: var(--chatbot-spacing);
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.chatbot-header-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.chatbot-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
}

.chatbot-avatar-placeholder {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
}

.chatbot-avatar-placeholder::before {
    content: 'ðŸ‘¤';
    font-size: 20px;
}

.chatbot-header-text {
    flex: 1;
}

.chatbot-title {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
}

.chatbot-status {
    margin: 4px 0 0;
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
    row-gap: 4px;
    opacity: 0.9;
}

.chatbot-status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #4ade80;
    animation: pulse 2s infinite;
}

.chatbot-status-indicator.disconnected {
    background: #f87171;
    animation: none;
}

.chatbot-connection-badge,
.chatbot-mode-chip,
.chatbot-api-type {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 2px 6px;
    border-radius: 999px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.04em;
}

.chatbot-connection-badge {
    background: rgba(34, 197, 94, 0.18);
    color: #047857;
}

.chatbot-connection-badge[data-status="offline"] {
    background: rgba(248, 113, 113, 0.22);
    color: #b91c1c;
}

.chatbot-mode-chip {
    background: rgba(59, 130, 246, 0.15);
    color: #1d4ed8;
}

.chatbot-mode-chip[data-mode="websocket"] {
    background: rgba(34, 197, 94, 0.18);
    color: #047857;
}

.chatbot-mode-chip[data-mode="sse"] {
    background: rgba(250, 204, 21, 0.2);
    color: #b45309;
}

.chatbot-mode-chip[data-mode="http"] {
    background: rgba(156, 163, 175, 0.25);
    color: #374151;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.chatbot-close {
    background: none;
    border: none;
    color: white;
    font-size: 18px;
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.chatbot-close:hover {
    background: rgba(255, 255, 255, 0.18);
}

/* Header controls */
.chatbot-header-controls {
    display: flex;
    align-items: center;
    gap: 6px;
}

.chatbot-maximize {
    background: none;
    border: none;
    color: white;
    font-size: 16px;
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: background-color 0.2s;
}

.chatbot-maximize:hover {
    background: rgba(255, 255, 255, 0.18);
}

/* Maximized state */
.chatbot-widget.is-maximized .chatbot-container {
    width: min(96vw, 920px);
    height: min(90vh, 90dvh);
}

.chatbot-widget.chatbot-floating.is-maximized {
    right: 20px;
    bottom: 20px;
}

.chatbot-widget.chatbot-floating.position-left.is-maximized {
    left: 20px;
    right: auto;
}

/* Messages container */
.chatbot-messages {
    flex: 1;
    overflow-y: auto;
    padding: var(--chatbot-spacing);
    background: var(--chatbot-background-color);
    scroll-behavior: smooth;
    overscroll-behavior: contain;
    min-height: 0;
    max-height: 100%;
}

.chatbot-messages::-webkit-scrollbar {
    width: 6px;
}

.chatbot-messages::-webkit-scrollbar-track {
    background: transparent;
}

.chatbot-messages::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 3px;
}

.chatbot-messages::-webkit-scrollbar-thumb:hover {
    background: #9ca3af;
}

/* Message styles */
.chatbot-message {
    margin-bottom: var(--chatbot-spacing);
    display: flex;
    gap: 8px;
}

.chatbot-message-user {
    flex-direction: row-reverse;
}

.chatbot-message-content {
    flex: 1;
    max-width: 80%;
}

.chatbot-message-user .chatbot-message-content {
    display: flex;
    justify-content: flex-end;
}

.message-api-indicator {
    align-self: flex-start;
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.04em;
    padding: 2px 6px;
    border-radius: 999px;
    background: rgba(31, 184, 205, 0.12);
    color: var(--chatbot-primary-color);
    text-transform: uppercase;
}

.chatbot-message-bubble {
    padding: 12px 16px;
    border-radius: var(--chatbot-border-radius);
    word-wrap: break-word;
    position: relative;
    overflow-wrap: anywhere;
    word-break: break-word;
    display: flex;
    flex-direction: column;
    gap: 8px;
    transition: background-color var(--chatbot-transition), border-color var(--chatbot-transition), transform var(--chatbot-transition);
}

/* Improve default floating height behavior on smaller viewports */
.chatbot-widget.chatbot-floating .chatbot-container {
    max-height: min(85vh, 85dvh);
}

.chatbot-message-assistant .chatbot-message-bubble {
    background: var(--chatbot-assistant-bubble, #fff);
    color: var(--chatbot-text-color);
    border: 1px solid var(--chatbot-border-color);
}

.chatbot-message-user .chatbot-message-bubble {
    background: var(--chatbot-user-bubble, var(--chatbot-primary-color));
    color: white;
    box-shadow: 0 12px 24px -12px rgba(0, 0, 0, 0.35);
}

.chatbot-message-avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    object-fit: cover;
    margin-top: 2px;
}

.chatbot-message-timestamp {
    font-size: 11px;
    opacity: 0.7;
    margin-top: 4px;
}

.message-files {
    display: grid;
    gap: 6px;
    margin-top: 4px;
}

.message-file-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 8px;
    border-radius: 8px;
    background: rgba(31, 184, 205, 0.1);
    color: var(--chatbot-text-color);
    font-size: 12px;
}

.message-file-item .file-name {
    flex: 1;
    overflow-wrap: anywhere;
}

.message-file-item .file-size {
    color: var(--chatbot-muted-color);
}

.message-file-item .file-icon {
    font-size: 14px;
}

/* Code blocks */
.chatbot-message-bubble pre {
    background: var(--chatbot-background-color);
    border: 1px solid var(--chatbot-border-color);
    border-radius: 4px;
    padding: 12px;
    margin: 8px 0 0;
    overflow-x: auto;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
    font-size: 13px;
}

.chatbot-message-bubble code {
    background: var(--chatbot-background-color);
    padding: 2px 4px;
    border-radius: 3px;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, monospace;
    font-size: 13px;
    color: inherit;
}

.chatbot-message-bubble pre code {
    background: none;
    padding: 0;
}

.chatbot-message-bubble h1,
.chatbot-message-bubble h2,
.chatbot-message-bubble h3,
.chatbot-message-bubble h4,
.chatbot-message-bubble h5,
.chatbot-message-bubble h6 {
    margin: 4px 0;
    font-weight: 600;
}

.chatbot-message-bubble blockquote {
    border-left: 3px solid var(--chatbot-primary-color);
    margin: 6px 0 0;
    padding-left: 10px;
    color: var(--chatbot-muted-color);
    font-style: italic;
}

.chatbot-message-bubble ul,
.chatbot-message-bubble ol {
    margin: 0;
    padding-left: 18px;
}

.chatbot-message-bubble table {
    width: 100%;
    border-collapse: collapse;
    border: 1px solid var(--chatbot-border-color);
    border-radius: 6px;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.6);
}

.chatbot-message-bubble table th,
.chatbot-message-bubble table td {
    border: 1px solid var(--chatbot-border-color);
    padding: 6px 8px;
    text-align: left;
    font-size: 13px;
}

.chatbot-message-bubble table th {
    background: rgba(31, 184, 205, 0.12);
    font-weight: 600;
}

.chatbot-message-bubble a {
    color: var(--chatbot-primary-color);
    text-decoration: underline;
}

/* Typing indicator */
.chatbot-typing {
    padding: var(--chatbot-spacing);
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--chatbot-background-color);
    color: var(--chatbot-muted-color);
    font-size: 13px;
}

.chatbot-typing-indicator {
    display: flex;
    gap: 4px;
}

.chatbot-typing-indicator span {
    width: 6px;
    height: 6px;
    background: var(--chatbot-muted-color);
    border-radius: 50%;
    animation: typing 1.4s infinite ease-in-out;
}

.chatbot-typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
.chatbot-typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

@keyframes typing {
    0%, 80%, 100% {
        transform: scale(0.8);
        opacity: 0.5;
    }
    40% {
        transform: scale(1);
        opacity: 1;
    }
}

/* Input container */
.chatbot-input-container {
    background: var(--chatbot-surface-color);
    border-top: 1px solid var(--chatbot-border-color);
    padding: var(--chatbot-spacing);
}

.chatbot-input-wrapper {
    display: flex;
    align-items: flex-end;
    gap: 8px;
    background: var(--chatbot-background-color);
    border: 1px solid var(--chatbot-border-color);
    border-radius: var(--chatbot-border-radius);
    padding: calc(var(--chatbot-spacing) / 1.6);
    transition: border-color 0.2s;
}

.chatbot-input-wrapper:focus-within {
    border-color: var(--chatbot-primary-color);
}

.chatbot-input-wrapper.is-busy {
    border-color: var(--chatbot-primary-color);
    box-shadow: inset 0 0 0 1px rgba(31, 184, 205, 0.2);
}

.chatbot-input-wrapper.is-disabled {
    opacity: 0.85;
}

.chatbot-input-wrapper.has-error {
    border-color: #ef4444;
    box-shadow: inset 0 0 0 1px rgba(239, 68, 68, 0.25);
}

.chatbot-input-wrapper.has-error .chatbot-input::placeholder {
    color: rgba(239, 68, 68, 0.85);
}

.chatbot-input {
    flex: 1;
    border: none;
    background: none;
    resize: none;
    outline: none;
    font-family: inherit;
    font-size: 14px;
    line-height: 1.5;
    min-height: 20px;
    max-height: 100px;
}

.chatbot-input::placeholder {
    color: var(--chatbot-muted-color);
}

.chatbot-input[data-busy="true"] {
    cursor: progress;
}

.chatbot-send {
    background: var(--chatbot-primary-color);
    border: none;
    color: white;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    flex-shrink: 0;
}

.chatbot-send:hover:not(:disabled) {
    background: var(--chatbot-accent-color);
    transform: scale(1.05);
}

.chatbot-send:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.chatbot-send[aria-busy="true"] {
    opacity: 0.6;
}

.chatbot-footer {
    text-align: center;
    margin-top: 8px;
}

.chatbot-powered-by {
    color: var(--chatbot-muted-color);
    font-size: 11px;
}

.chatbot-powered-by a {
    color: var(--chatbot-primary-color);
    text-decoration: none;
}

.chatbot-powered-by a:hover {
    text-decoration: underline;
}

.chatbot-proactive {
    position: absolute;
    bottom: calc(100% + 12px);
    right: 0;
    max-width: min(280px, 85vw);
    background: var(--chatbot-surface-color);
    border: 1px solid var(--chatbot-border-color);
    border-radius: var(--chatbot-border-radius);
    box-shadow: var(--chatbot-shadow);
    padding: 14px;
    opacity: 0;
    transform: translateY(8px);
    pointer-events: none;
    transition: opacity var(--chatbot-transition), transform var(--chatbot-transition);
    z-index: 2;
}

.chatbot-proactive.is-visible {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}

.proactive-inner {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.proactive-message {
    font-size: 13px;
    color: var(--chatbot-text-color);
}

.proactive-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.proactive-cta {
    background: var(--chatbot-primary-color);
    border: none;
    color: #fff;
    padding: 6px 12px;
    border-radius: 999px;
    font-size: 12px;
    cursor: pointer;
    transition: background-color var(--chatbot-transition), transform var(--chatbot-transition);
}

.proactive-cta:hover {
    background: var(--chatbot-accent-color);
    transform: translateY(-1px);
}

.proactive-dismiss {
    background: none;
    border: none;
    color: var(--chatbot-muted-color);
    font-size: 14px;
    align-self: flex-end;
    cursor: pointer;
}

.chatbot-inline .chatbot-proactive {
    position: relative;
    bottom: auto;
    right: auto;
    margin-top: var(--chatbot-spacing);
    max-width: 100%;
    transform: translateY(0);
}

.chatbot-inline .chatbot-proactive.is-visible {
    opacity: 1;
}

/* Error message styles */
.chatbot-message-error .chatbot-message-bubble {
    background: #fee2e2;
    border-color: #fecaca;
    color: #dc2626;
}

/* Streaming message styles */
.chatbot-message.chatbot-streaming .chatbot-message-bubble::after {
    content: '|';
    animation: blink 1s infinite;
}

@keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0; }
}

/* Mobile responsive styles */
@media (max-width: 480px) {
    .chatbot-floating {
        bottom: 10px;
        right: 10px;
        left: 10px;
        width: auto;
    }

    .chatbot-container {
        width: 100%;
        height: min(78vh, 620px);
        max-height: min(78vh, 620px);
    }

    .chatbot-toggle {
        width: 50px;
        height: 50px;
        position: fixed;
        bottom: 20px;
        right: 20px;
        left: auto;
        width: auto;
    }

    .chatbot-message-content {
        max-width: 90%;
    }

    .chatbot-header {
        padding: 12px;
    }

    .chatbot-messages {
        padding: 12px;
    }

    .chatbot-input-container {
        padding: 12px;
    }
}

@media (max-width: 768px) {
    .chatbot-widget {
        --chatbot-width: min(100vw - 32px, 420px);
        --chatbot-height: min(80vh, 640px);
        --chatbot-max-height: min(80vh, 640px);
    }

    .chatbot-floating.position-bottom-right,
    .chatbot-floating.position-bottom-left,
    .chatbot-floating.position-top-right,
    .chatbot-floating.position-top-left {
        right: 16px;
        left: 16px;
        top: auto;
        bottom: 16px;
    }

    .chatbot-floating.position-top-right,
    .chatbot-floating.position-top-left {
        top: 16px;
        bottom: auto;
    }
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
    .chatbot-widget {
        --chatbot-background-color: #1f2937;
        --chatbot-surface-color: #374151;
        --chatbot-text-color: #f9fafb;
        --chatbot-muted-color: #9ca3af;
        --chatbot-assistant-bubble: #4b5563;
        --chatbot-user-bubble: var(--chatbot-primary-color);
    }

    .chatbot-message-assistant .chatbot-message-bubble {
        background: #4b5563;
        color: #f9fafb;
        border-color: #6b7280;
    }

    .chatbot-input-wrapper {
        background: #374151;
        border-color: #6b7280;
    }

    .message-file-item {
        background: rgba(31, 184, 205, 0.2);
    }

    .chatbot-proactive {
        background: #1f2937;
        border-color: #4b5563;
        box-shadow: 0 20px 40px -24px rgba(0, 0, 0, 0.8);
    }

    .proactive-cta {
        color: #0f172a;
    }

    .chatbot-messages::-webkit-scrollbar-thumb {
        background: #6b7280;
    }

    .chatbot-message-bubble pre {
        background: #1f2937;
        border-color: #374151;
        color: #f9fafb;
    }

    .chatbot-message-bubble code {
        background: #1f2937;
        color: #f9fafb;
    }

    .chatbot-connection-badge[data-status="offline"] {
        background: rgba(248, 113, 113, 0.28);
    }
}

/* Print styles */
@media print {
    .chatbot-widget {
        display: none !important;
    }
}

/* High contrast mode */
@media (prefers-contrast: high) {
    .chatbot-widget {
        --chatbot-border-radius: 4px;
    }

    .chatbot-message-bubble {
        border: 2px solid currentColor;
    }

    .chatbot-input-wrapper {
        border-width: 2px;
    }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
    .chatbot-widget *,
    .chatbot-widget *::before,
    .chatbot-widget *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }

    .chatbot-typing-indicator span {
        animation: none;
        opacity: 0.7;
    }

    .chatbot-status-indicator {
        animation: none;
    }
}

/* Tool call indicators */
.tool-execution {
    margin-top: 8px;
    padding: 8px 10px;
    border-radius: 8px;
    background: rgba(31, 184, 205, 0.08);
    border: 1px solid rgba(31, 184, 205, 0.2);
    font-size: 12px;
    color: var(--chatbot-muted-color);
}

.tool-execution .tool-info {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 4px;
}

.tool-execution .tool-icon {
    font-size: 14px;
}

.tool-execution .tool-status {
    color: #059669;
    font-weight: 600;
    font-size: 11px;
}

.tool-execution .tool-arguments {
    white-space: pre-wrap;
    font-family: 'Courier New', Courier, monospace;
    background: rgba(0, 0, 0, 0.03);
    padding: 6px 8px;
    border-radius: 6px;
    color: var(--chatbot-text-color);
}

.chatbot-message-bubble.hide-tool-events .tool-execution {
    display: none;
}
